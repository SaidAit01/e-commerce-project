import { defineService, implementService, } from "@wix/services-definitions";
import { SignalsServiceDefinition, } from "@wix/services-definitions/core-services/signals";
export const PayNowServiceDefinition = defineService("PayNow");
export const PayNowServiceImplementation = implementService.withConfig()(PayNowServiceDefinition, ({ getService, config }) => {
    const signalsService = getService(SignalsServiceDefinition);
    const loadingSignal = signalsService.signal(false);
    const errorSignal = signalsService.signal(null);
    return {
        redirectToCheckout: async () => {
            loadingSignal.set(true);
            try {
                if (config.customCheckoutAction) {
                    const result = await config.customCheckoutAction();
                    if (result && result.data) {
                        window.location.href = result.data;
                    }
                    else {
                        throw new Error("Failed to create checkout" + result?.error);
                    }
                }
            }
            catch (error) {
                errorSignal.set(error.toString());
                loadingSignal.set(false);
            }
        },
        loadingSignal,
        errorSignal,
    };
});
export const loadPayNowServiceInitialData = async () => {
    return {
        [PayNowServiceDefinition]: {},
    };
};
export const payNowServiceBinding = (servicesConfigs, additionalConfig = {}) => {
    return [
        PayNowServiceDefinition,
        PayNowServiceImplementation,
        {
            ...servicesConfigs[PayNowServiceDefinition],
            ...additionalConfig,
        },
    ];
};
