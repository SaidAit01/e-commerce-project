{"version":3,"names":["React","_interopRequireWildcard","require","_ImageModule","_interopRequireDefault","imageKit","exports","_jsxFileName","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","STATIC_MEDIA_URL","fetchLQIP","fittingType","src","target","options","placeholder","getPlaceholder","autoEncode","uri","test","SCHEME_RE","Image","props","_ssrResult$css","_srcset$dpr","id","containerId","alt","name","role","width","height","displayMode","devicePixelRatio","quality","alignType","bgEffectName","focalPoint","upscaleMethod","className","crop","imageStyles","targetWidth","targetHeight","targetScale","onLoad","onError","shouldUseLQIP","containerWidth","containerHeight","isInFirstFold","placeholderTransition","socialAttrs","isSEOBot","skipMeasure","hasAnimation","encoding","imageRef","useRef","hasSsrSrc","hasBlurTransition","ssrImageData","current","shouldLoadHQImage","alignment","htmlTag","transformed","undefined","css","img","attr","container","isLQIP","imageInfo","useMemo","JSON","stringify","lqipTransition","imageData","ssrResult","srcset","placeholderStyle","classNames","styles","image","useEffect","imgElement","currentSrc","complete","maxWidth","createElement","class","style","__self","__source","fileName","lineNumber","columnNumber","_extends2","ref","srcSet","dpr","map","s","join","fetchpriority","loading","suppressHydrationWarning"],"sources":["../../src/Image.tsx"],"sourcesContent":["import * as React from 'react';\nimport type { ImageInfo, ImageProps } from './types';\nimport styles from './Image.module.scss';\nimport { ImageAttributesData, ImagePlaceholderData } from './types';\nimport * as imageKit from '@wix/image-kit';\n\nconst { STATIC_MEDIA_URL } = imageKit;\n\nconst fetchLQIP = ({\n  fittingType,\n  src,\n  target,\n  options,\n}: ImagePlaceholderData): ImageAttributesData => {\n  const placeholder = imageKit.getPlaceholder(fittingType, src, target, {\n    ...options,\n    autoEncode: true,\n  });\n\n  if (placeholder?.uri && !/^[a-z]+:/.test(placeholder.uri)) {\n    placeholder.uri = `${STATIC_MEDIA_URL}${placeholder.uri}`;\n  }\n\n  return placeholder as ImageAttributesData;\n};\n\nconst SCHEME_RE = /^[a-z]+:/;\n\nconst Image: React.FC<ImageProps> = (props) => {\n  const {\n    id,\n    containerId,\n    uri,\n    alt,\n    name = '',\n    role,\n    width,\n    height,\n    displayMode,\n    devicePixelRatio,\n    quality,\n    alignType,\n    bgEffectName = '',\n    focalPoint,\n    upscaleMethod,\n    className = '',\n    crop,\n    imageStyles = {},\n    targetWidth,\n    targetHeight,\n    targetScale,\n    onLoad = () => {},\n    onError = () => {},\n    shouldUseLQIP,\n    containerWidth,\n    containerHeight,\n    getPlaceholder,\n    isInFirstFold,\n    placeholderTransition,\n    socialAttrs,\n    isSEOBot,\n    skipMeasure,\n    hasAnimation,\n    encoding,\n  } = props;\n  const imageRef = React.useRef<HTMLImageElement>(null);\n  // fix containerId and id to support hoverBox component\n  let hasSsrSrc: '' | 'true' = '';\n\n  const hasBlurTransition = placeholderTransition === 'blur';\n\n  const ssrImageData = React.useRef<ImageAttributesData | null>(null);\n\n  if (!ssrImageData.current) {\n    if (getPlaceholder || shouldUseLQIP || isInFirstFold || isSEOBot) {\n      const options = {\n        upscaleMethod,\n        ...(quality ? quality : {}),\n        shouldLoadHQImage: isInFirstFold,\n        isSEOBot,\n        hasAnimation,\n        encoding,\n      };\n\n      ssrImageData.current = (getPlaceholder || fetchLQIP)({\n        fittingType: displayMode,\n        src: {\n          id: uri,\n          width,\n          height,\n          crop,\n          name,\n          focalPoint,\n        },\n        target: {\n          width: containerWidth,\n          height: containerHeight,\n          alignment: alignType,\n          htmlTag: 'img',\n        },\n        options,\n      });\n\n      hasSsrSrc =\n        !ssrImageData.current.transformed || isInFirstFold || isSEOBot\n          ? ''\n          : 'true';\n    } else {\n      // to keep an empty placeholder data\n      ssrImageData.current = {\n        uri: undefined, // to remove src attribute completely\n        css: { img: {} },\n        attr: { img: {}, container: {} },\n        transformed: false,\n      };\n    }\n  }\n\n  const isLQIP =\n    !isSEOBot &&\n    (getPlaceholder || shouldUseLQIP) &&\n    !isInFirstFold &&\n    ssrImageData.current.transformed;\n\n  const imageInfo = React.useMemo(\n    () =>\n      JSON.stringify({\n        containerId,\n        ...(containerId && { containerId }),\n        ...(alignType && { alignType }),\n        ...(skipMeasure && { skipMeasure: true }),\n        displayMode,\n        ...(containerWidth && { targetWidth: containerWidth }),\n        ...(containerHeight && { targetHeight: containerHeight }),\n        ...(targetWidth && { targetWidth }),\n        ...(targetHeight && { targetHeight }),\n        ...(targetScale && { targetScale }),\n        isLQIP,\n        isSEOBot,\n        lqipTransition: placeholderTransition,\n        encoding,\n        imageData: {\n          width,\n          height,\n          uri,\n          name,\n          displayMode,\n          hasAnimation,\n          ...(quality && { quality }),\n          ...(devicePixelRatio && { devicePixelRatio }),\n          ...(focalPoint && { focalPoint }),\n          ...(crop && { crop }),\n          ...(upscaleMethod && { upscaleMethod }),\n        },\n      } satisfies ImageInfo),\n    [\n      containerId,\n      alignType,\n      skipMeasure,\n      displayMode,\n      containerWidth,\n      containerHeight,\n      targetWidth,\n      targetHeight,\n      targetScale,\n      isLQIP,\n      isSEOBot,\n      placeholderTransition,\n      encoding,\n      width,\n      height,\n      uri,\n      name,\n      hasAnimation,\n      quality,\n      devicePixelRatio,\n      focalPoint,\n      crop,\n      upscaleMethod,\n    ],\n  );\n\n  const ssrResult = ssrImageData.current;\n  const src = ssrResult?.uri;\n  const srcset = ssrResult?.srcset;\n  const placeholderStyle = ssrResult.css?.img;\n  const classNames = `${styles.image} ${className}`;\n\n  React.useEffect(() => {\n    // When image comes from cache onLoad not trigger on native HTML element\n    const imgElement = imageRef.current;\n    if (onLoad && imgElement?.currentSrc && imgElement?.complete) {\n      onLoad({\n        target: imgElement,\n      } satisfies Partial<React.SyntheticEvent<HTMLImageElement>> as unknown as React.SyntheticEvent<HTMLImageElement>);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const maxWidth =\n    ssrResult && !ssrResult?.transformed\n      ? `max(${width}px, 100%)`\n      : targetWidth\n      ? `${targetWidth}px`\n      : null;\n\n  return (\n    <wow-image\n      id={id}\n      class={classNames}\n      data-image-info={imageInfo}\n      // TODO: get the correct id to place here\n      data-motion-part={`BG_IMG ${containerId}`}\n      data-bg-effect-name={bgEffectName}\n      data-has-ssr-src={hasSsrSrc}\n      data-animate-blur={\n        !isSEOBot && isLQIP && hasBlurTransition ? '' : undefined\n      }\n      style={maxWidth ? { '--wix-img-max-width': maxWidth } : {}}\n    >\n      <img\n        src={src}\n        ref={imageRef}\n        alt={alt || ''}\n        role={role}\n        style={{ ...placeholderStyle, ...imageStyles }}\n        onLoad={onLoad}\n        onError={onError}\n        width={containerWidth ? containerWidth : undefined}\n        height={containerHeight ? containerHeight : undefined}\n        {...socialAttrs}\n        srcSet={\n          isInFirstFold\n            ? srcset?.dpr\n                ?.map((s: string) =>\n                  SCHEME_RE.test(s) ? s : `${STATIC_MEDIA_URL}${s}`,\n                )\n                .join(', ')\n            : undefined\n        }\n        // @ts-expect-error fetchpriority type should work in react > 18.3 https://github.com/facebook/react/pull/25927\n        fetchpriority={isInFirstFold ? 'high' : undefined}\n        loading={isInFirstFold === false ? 'lazy' : undefined}\n        // The src attribute triggers a mismatch warning because wow-image updates its src outside of the React lifecycle. This causes React to retain the old value in the virtual DOM, which could potentially lead to a bug where the old value is re-rendered during updates. However, weâ€™re confident that this issue is not reproducing in current (16-18) React versions\n        suppressHydrationWarning\n      />\n    </wow-image>\n  );\n};\n\nexport { Image, imageKit };\n"],"mappings":"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","ignoreList":[]}