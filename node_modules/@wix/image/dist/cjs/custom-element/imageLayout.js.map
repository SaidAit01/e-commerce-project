{"version":3,"names":["_utils","require","MOBILE_SAFE_ADDRESSBAR_HEIGHT","getHeightOverride","height","mediaHeightOverrideType","document","documentElement","clientHeight","computeScaleOverrides","imageStyle","targetScale","width","computeStyleOverrides","displayMode","isResponsive","styleWithScale","style","position","top","objectPosition","replace","getSourceSetsTargetHeightByEffect","sourceSets","offsetWidth","offsetHeight","screenHeight","services","sourceSetsTargetHeights","forEach","mediaQuery","scrollEffect","getMediaDimensionsByEffect","computeSrcSets","measures","imageInfo","envConsts","length","mediaToUri","crop","focalPoint","imageInfoClone","targetHeight","imageData","imageComputedProperties","getImageComputedProperties","uri","measure","id","domNodes","containerElm","bgEffect","innerImage","image","wixImage","getScreenHeight","getScreenHeightOverride","dataset","hasBgEffect","some","srcset","sourceOfDimensions","cssBgEffect","window","getComputedStyle","getPropertyValue","imgSrc","getImageSrc","left","boundingRect","getBoundingClientRect","patch","loadImage","loadImageImmediately","_imageComputedPropert","Object","keys","wixImageNode","devicePixelRatio","extendedImageInfo","skipMeasure","targetWidth","computedStyle","css","img","setStyle","src","hasAnimation","ssrSrcDone","isLQIP","lqipTransition","transitioned","complete","onload","loadDone","imageIsAnimated","setAttribute","currentSrc","srcIsMissingFromSrcset","split","source","picture","Array","from","querySelectorAll","sourceNode","media","_default","exports","default"],"sources":["../../../src/custom-element/imageLayout.ts"],"sourcesContent":["import {\n  getScreenHeight,\n  setStyle,\n  getImageComputedProperties,\n  getImageSrc,\n  imageIsAnimated,\n} from './utils';\nimport type {\n  WixImageServices,\n  FittingType,\n  ImageInfo,\n  SourceSet,\n  WixImageMeasures,\n  WixImageDomNodes,\n  EnvConsts,\n} from '../types';\n\nconst MOBILE_SAFE_ADDRESSBAR_HEIGHT = 80;\n\nfunction getHeightOverride(\n  height: number,\n  mediaHeightOverrideType: WixImageMeasures['mediaHeightOverrideType'],\n) {\n  // on mobile, documentElement.clientHeight changes when scrolling, because of address bar collapsing.\n  // avoiding re-fetching image by returning the same height\n  return mediaHeightOverrideType === 'fixed' ||\n    mediaHeightOverrideType === 'viewport'\n    ? document.documentElement.clientHeight + MOBILE_SAFE_ADDRESSBAR_HEIGHT\n    : height;\n}\n\nfunction computeScaleOverrides(\n  imageStyle: Record<string, string>,\n  targetScale = 1,\n) {\n  return targetScale !== 1\n    ? {\n        ...imageStyle,\n        width: '100%',\n        height: '100%',\n      }\n    : imageStyle;\n}\n\n/**\n * compute specific overrides\n */\nfunction computeStyleOverrides(\n  mediaHeightOverrideType: WixImageMeasures['mediaHeightOverrideType'],\n  imageStyle: Record<string, string>,\n  displayMode: FittingType,\n  targetScale: number,\n  isResponsive: boolean,\n) {\n  // image scaling override\n  const styleWithScale = computeScaleOverrides(imageStyle, targetScale);\n  if (isResponsive) {\n    delete styleWithScale.height;\n    styleWithScale.width = '100%';\n  }\n  if (!mediaHeightOverrideType) {\n    return styleWithScale;\n  }\n  // siteBackground on mobile\n  const style: Record<string, string> = { ...styleWithScale };\n\n  if (displayMode === 'fill') {\n    style.position = 'absolute';\n    style.top = '0';\n  } else if (displayMode === 'fit') {\n    style.height = '100%';\n  }\n\n  if (mediaHeightOverrideType === 'fixed') {\n    // eliminates white gap when address bar is collapsing\n    style['will-change'] = 'transform';\n  }\n\n  // force image alignment to include top\n  if (style.objectPosition) {\n    style.objectPosition = (imageStyle.objectPosition as string).replace(\n      /(center|bottom)$/,\n      'top',\n    );\n  }\n\n  return style;\n}\n\nfunction getSourceSetsTargetHeightByEffect(\n  sourceSets: SourceSet[],\n  offsetWidth: number,\n  offsetHeight: number,\n  screenHeight: number,\n  services: WixImageServices,\n) {\n  const sourceSetsTargetHeights: { [key: string]: number } = {};\n  sourceSets.forEach(({ mediaQuery, scrollEffect }) => {\n    sourceSetsTargetHeights[mediaQuery] =\n      services.getMediaDimensionsByEffect?.(\n        scrollEffect,\n        offsetWidth,\n        offsetHeight,\n        screenHeight,\n      ).height || offsetHeight;\n  });\n  return sourceSetsTargetHeights;\n}\n\nfunction computeSrcSets(\n  measures: WixImageMeasures,\n  imageInfo: ImageInfo,\n  envConsts: EnvConsts,\n) {\n  const { sourceSets } = imageInfo;\n  if (!sourceSets || !sourceSets.length) {\n    return;\n  }\n\n  const mediaToUri: { [key: string]: string } = {};\n  sourceSets.forEach(({ mediaQuery, crop, focalPoint }) => {\n    const imageInfoClone = {\n      ...imageInfo,\n      targetHeight: (measures.sourceSetsTargetHeights || {})[mediaQuery] || 0,\n      imageData: {\n        ...imageInfo.imageData,\n        crop,\n        focalPoint,\n      },\n    };\n    const imageComputedProperties = getImageComputedProperties(\n      imageInfoClone,\n      envConsts,\n      'img',\n    );\n    mediaToUri[mediaQuery] = imageComputedProperties.uri || '';\n  });\n  return mediaToUri;\n}\n\nfunction measure(\n  id: string,\n  measures: WixImageMeasures,\n  domNodes: WixImageDomNodes,\n  {\n    containerElm,\n    bgEffect = 'none',\n    sourceSets,\n  }: {\n    containerElm: HTMLElement | undefined;\n    bgEffect?: string;\n    sourceSets?: SourceSet[];\n  },\n  services: WixImageServices,\n) {\n  const innerImage = domNodes.image as HTMLImageElement;\n  const wixImage = domNodes[id] as HTMLElement;\n  const screenHeight = getScreenHeight(services.getScreenHeightOverride?.());\n\n  // override positioning and scaling of image (SiteBackground mobile override behaviour)\n  const mediaHeightOverrideType = containerElm?.dataset\n    .mediaHeightOverrideType as\n    | WixImageMeasures['mediaHeightOverrideType']\n    | undefined;\n\n  const hasBgEffect =\n    (bgEffect && bgEffect !== 'none') ||\n    (sourceSets && sourceSets.some((srcset) => srcset.scrollEffect));\n  const sourceOfDimensions = (\n    containerElm && hasBgEffect ? containerElm : wixImage\n  ) as HTMLElement; // default to self\n  const cssBgEffect = window\n    .getComputedStyle(wixImage)\n    .getPropertyValue('--bg-scrub-effect');\n\n  const { width, height } = services.getMediaDimensionsByEffect?.(\n    cssBgEffect || bgEffect,\n    sourceOfDimensions.offsetWidth,\n    sourceOfDimensions.offsetHeight,\n    screenHeight,\n  ) || {\n    width: wixImage.offsetWidth,\n    height: wixImage.offsetHeight,\n  };\n  if (sourceSets) {\n    measures.sourceSetsTargetHeights = getSourceSetsTargetHeightByEffect(\n      sourceSets,\n      sourceOfDimensions.offsetWidth,\n      sourceOfDimensions.offsetHeight,\n      screenHeight,\n      services,\n    );\n  }\n\n  if (!innerImage) {\n    return;\n  }\n\n  const imgSrc = getImageSrc(innerImage);\n\n  if (cssBgEffect) {\n    measures.top = 0.5 * (wixImage.offsetHeight - height);\n    measures.left = 0.5 * (wixImage.offsetWidth - width);\n  }\n  measures.width = width;\n  measures.height = getHeightOverride(height, mediaHeightOverrideType);\n  measures.screenHeight = screenHeight;\n  measures.imgSrc = imgSrc;\n  measures.boundingRect = wixImage!.getBoundingClientRect();\n  measures.mediaHeightOverrideType = mediaHeightOverrideType;\n  measures.srcset = innerImage.srcset;\n}\n\nfunction patch(\n  id: string,\n  measures: WixImageMeasures,\n  domNodes: Record<string, HTMLElement | HTMLImageElement | null>,\n  imageInfo: ImageInfo,\n  envConsts: EnvConsts,\n  loadImage: boolean,\n  isResponsive: boolean,\n  bgEffect?: string,\n  loadImageImmediately?: boolean,\n) {\n  if (!Object.keys(measures).length) {\n    return;\n  }\n\n  const { imageData } = imageInfo;\n  const wixImageNode = domNodes[id] as HTMLElement;\n  const image = domNodes.image as HTMLImageElement;\n\n  // no retina scaling for background scroll effects\n  if (bgEffect) {\n    imageData.devicePixelRatio = 1;\n  }\n\n  const targetScale = imageInfo.targetScale || 1;\n\n  const extendedImageInfo = {\n    ...imageInfo,\n    ...(!imageInfo.skipMeasure && {\n      targetWidth: (measures.width || 0) * targetScale,\n      targetHeight: (measures.height || 0) * targetScale,\n    }),\n    displayMode: imageData.displayMode,\n  };\n\n  const imageComputedProperties = getImageComputedProperties(\n    extendedImageInfo,\n    envConsts,\n    'img',\n  );\n  const computedStyle =\n    (imageComputedProperties?.css as { img: {} })?.img || {};\n  const imageStyle = computeStyleOverrides(\n    measures.mediaHeightOverrideType,\n    computedStyle,\n    imageData.displayMode,\n    targetScale,\n    isResponsive,\n  );\n  setStyle(image, imageStyle);\n  if (measures.top || measures.left) {\n    setStyle(wixImageNode, {\n      top: `${measures.top}px`,\n      left: `${measures.left}px`,\n    });\n  }\n\n  const src = imageComputedProperties?.uri || '';\n  const hasAnimation = imageData?.hasAnimation || imageInfo?.hasAnimation;\n\n  const mediaToUri = computeSrcSets(measures, extendedImageInfo, envConsts);\n\n  if (loadImageImmediately) {\n    // flag that this image has been processed\n    image.dataset.ssrSrcDone = 'true';\n  }\n\n  if (\n    imageInfo.isLQIP &&\n    imageInfo.lqipTransition &&\n    !('transitioned' in wixImageNode.dataset)\n  ) {\n    wixImageNode.dataset.transitioned = '';\n\n    if (image.complete) {\n      image.onload = function () {\n        image.dataset.loadDone = '';\n      };\n    } else {\n      image.onload = function () {\n        if (image.complete) {\n          image.dataset.loadDone = '';\n        } else {\n          image.onload = function () {\n            image.dataset.loadDone = '';\n          };\n        }\n      };\n    }\n  }\n\n  if (loadImage) {\n    if (imageIsAnimated(imageData.uri, hasAnimation)) {\n      image.setAttribute('fetchpriority', 'low');\n      image.setAttribute('loading', 'lazy');\n      image.setAttribute('decoding', 'async');\n    } else {\n      image.setAttribute('fetchpriority', 'high');\n    }\n    image.currentSrc !== src && image.setAttribute('src', src);\n    const srcIsMissingFromSrcset =\n      measures.srcset &&\n      !measures.srcset\n        .split(', ')\n        .some((source) => source.split(' ')[0] === src);\n    if (srcIsMissingFromSrcset) {\n      image.setAttribute('srcset', src);\n    }\n    if (domNodes.picture && extendedImageInfo.sourceSets) {\n      Array.from(domNodes.picture.querySelectorAll('source')).forEach(\n        (sourceNode) => {\n          const mediaQuery = sourceNode.media || '';\n          const uri = mediaToUri?.[mediaQuery];\n          if (sourceNode.srcset !== uri) {\n            sourceNode.setAttribute('srcset', uri || '');\n          }\n        },\n      );\n    }\n  }\n}\n\nexport default {\n  measure,\n  patch,\n};\n"],"mappings":"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","ignoreList":[]}