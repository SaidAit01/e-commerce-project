{"version":3,"names":["getAllImageSrcs","imgs","page","$$","srcs","Promise","all","map","img","srcProperty","getProperty","jsonValue","getImageSrc","imgIndex","scrollToImg","scrollY","evaluate","_getBoundingClientRec","document","querySelectorAll","element","elementTop","getBoundingClientRect","top","window","marginOffset","innerHeight","scrollTo","behavior","waitForTimeout","checkImageScroll","expectedSrc","imageIndex","src","expect","toContain","newSrc","not","describe","beforeEach","goto","test","firstImgSrc","secondImgSrc","thirdImgSrc","it","waitForFunction","hasSsrSrcAttribute","$eval","getAttribute","ssrSrcDone","toBe"],"sources":["../../../src/__tests__/Image.e2e.ts"],"sourcesContent":["async function getAllImageSrcs() {\n  const imgs = await page.$$('img');\n  const srcs = await Promise.all(\n    imgs.map(async (img) => {\n      const srcProperty = await img.getProperty('src');\n      return srcProperty?.jsonValue();\n    }),\n  );\n  return srcs;\n}\n\nasync function getImageSrc(imgIndex: number) {\n  return (await getAllImageSrcs())[imgIndex];\n}\n\nasync function scrollToImg(imgIndex: number, scrollY: number) {\n  await page.evaluate(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    (imgIndex, scrollY) => {\n      const imgs = document.querySelectorAll('img');\n      const element = imgs[imgIndex];\n      const elementTop = element!.getBoundingClientRect()?.top + window.scrollY;\n      const marginOffset = window.innerHeight * scrollY;\n\n      window.scrollTo({\n        top: elementTop - marginOffset,\n        behavior: 'instant' as any, // @see https://github.com/Microsoft/TypeScript/issues/28755\n      });\n    },\n    imgIndex,\n    scrollY,\n  );\n  await page.waitForTimeout(100);\n}\n\nasync function checkImageScroll({\n  expectedSrc,\n  imageIndex,\n}: {\n  expectedSrc: string;\n  imageIndex: number;\n}) {\n  await scrollToImg(imageIndex, 2.7);\n  const src = await getImageSrc(imageIndex);\n  expect(src).toContain(expectedSrc);\n  expect(src).toContain('blur');\n  await scrollToImg(imageIndex, 2.5);\n  const newSrc = await getImageSrc(imageIndex);\n  expect(newSrc).not.toContain('blur');\n}\n\ndescribe('Image', () => {\n  describe('Lazy load', () => {\n    beforeEach(async () => {\n      await page.goto(\n        'http://localhost:3000/iframe.html?path=/story/image--lazy-load-image',\n      );\n    });\n\n    test('Should img src', async () => {\n      const [firstImgSrc, secondImgSrc, thirdImgSrc] = await getAllImageSrcs();\n\n      expect(firstImgSrc).toContain(\n        '11062b_9c53b59db1dc4bd4ad7a47340f0594b4~mv2.jpg',\n      );\n      expect(firstImgSrc).not.toContain('blur');\n      expect(secondImgSrc).toContain(\n        '11062b_a1495416958849dd8682868426dd876b~mv2.jpg',\n      );\n      expect(secondImgSrc).toContain('blur');\n      expect(thirdImgSrc).toContain(\n        '11062b_bdbc8112d5bd4e3988b694612ca6cfd3~mv2.jpg',\n      );\n      expect(thirdImgSrc).toContain('blur');\n\n      await checkImageScroll({\n        expectedSrc: '11062b_a1495416958849dd8682868426dd876b~mv2.jpg',\n        imageIndex: 1,\n      });\n      await checkImageScroll({\n        expectedSrc: '11062b_bdbc8112d5bd4e3988b694612ca6cfd3~mv2.jpg',\n        imageIndex: 2,\n      });\n    });\n  });\n\n  describe('SSR src hydration', () => {\n    it('should not remove data-has-ssr-src and add data-ssr-src-done attributes', async () => {\n      await page.goto(\n        'http://localhost:3000/iframe.html?path=/story/image--ssr-image',\n      );\n\n      await page.waitForFunction(\n        `document.querySelector(\"wow-image img\")?.getAttribute(\"data-ssr-src-done\") == \"true\"`,\n      );\n\n      const hasSsrSrcAttribute = await page.$eval('wow-image', (element) =>\n        element.getAttribute('data-has-ssr-src'),\n      );\n\n      const ssrSrcDone = await page.$eval('wow-image img', (element) =>\n        element.getAttribute('data-ssr-src-done'),\n      );\n\n      expect(hasSsrSrcAttribute).toBe('true');\n      expect(ssrSrcDone).toBe('true');\n    });\n  });\n});\n"],"mappings":"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","ignoreList":[]}