{"version":3,"names":["_i18next","_interopRequireDefault","require","_i18nextIcu","initI18n","locale","asyncMessagesLoader","i18nInstance","i18n","createInstance","lng","fallbackLng","keySeparator","use","ICU","customBackend","exports","type","init","read","language","_namespace","callback","translation","err"],"sources":["../../../src/public-testkit/initI18n.ts"],"sourcesContent":["import i18n, { BackendModule } from 'i18next';\nimport ICU from 'i18next-icu';\nimport { Messages } from '@wix/error-handler-core/types';\n\ninterface i18nOptions {\n  asyncMessagesLoader?: (language: string) => Promise<Messages>;\n  disableAutoInit?: boolean;\n  locale?: string;\n}\n\nexport const initI18n = ({ locale, asyncMessagesLoader }: i18nOptions) => {\n  const i18nInstance = i18n\n    .createInstance({\n      lng: locale || 'en',\n      fallbackLng: 'en',\n      keySeparator: false,\n    })\n    .use(ICU);\n\n  if (asyncMessagesLoader) {\n    i18nInstance.use(customBackend({ asyncMessagesLoader }));\n  }\n\n  return i18nInstance;\n};\n\nfunction customBackend({\n  asyncMessagesLoader,\n}: {\n  asyncMessagesLoader: (language: string) => Promise<Messages>;\n}): BackendModule {\n  return {\n    type: 'backend',\n    init: () => {},\n    read: async (language, _namespace, callback) => {\n      try {\n        const translation = await asyncMessagesLoader(language);\n        return callback(null, translation);\n      } catch (err) {\n        return callback(err as Error, null);\n      }\n    },\n  };\n}\n"],"mappings":";;;;;AAAA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,WAAA,GAAAF,sBAAA,CAAAC,OAAA;AASO,MAAME,QAAQ,GAAGA,CAAC;EAAEC,MAAM;EAAEC;AAAiC,CAAC,KAAK;EACxE,MAAMC,YAAY,GAAGC,gBAAI,CACtBC,cAAc,CAAC;IACdC,GAAG,EAAEL,MAAM,IAAI,IAAI;IACnBM,WAAW,EAAE,IAAI;IACjBC,YAAY,EAAE;EAChB,CAAC,CAAC,CACDC,GAAG,CAACC,mBAAG,CAAC;EAEX,IAAIR,mBAAmB,EAAE;IACvBC,YAAY,CAACM,GAAG,CAACE,aAAa,CAAC;MAAET;IAAoB,CAAC,CAAC,CAAC;EAC1D;EAEA,OAAOC,YAAY;AACrB,CAAC;AAACS,OAAA,CAAAZ,QAAA,GAAAA,QAAA;AAEF,SAASW,aAAaA,CAAC;EACrBT;AAGF,CAAC,EAAiB;EAChB,OAAO;IACLW,IAAI,EAAE,SAAS;IACfC,IAAI,EAAEA,CAAA,KAAM,CAAC,CAAC;IACdC,IAAI,EAAE,MAAAA,CAAOC,QAAQ,EAAEC,UAAU,EAAEC,QAAQ,KAAK;MAC9C,IAAI;QACF,MAAMC,WAAW,GAAG,MAAMjB,mBAAmB,CAACc,QAAQ,CAAC;QACvD,OAAOE,QAAQ,CAAC,IAAI,EAAEC,WAAW,CAAC;MACpC,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZ,OAAOF,QAAQ,CAACE,GAAG,EAAW,IAAI,CAAC;MACrC;IACF;EACF,CAAC;AACH","ignoreList":[]}