{"version":3,"names":["createChildEssentials","essentialsTestkit","context","events","options","translations","errorMonitor","transport","sentryTransport","i18n","asyncMessagesLoader","locale","_options$i18n","pause","Promise","resolve","reject","once","errorLng","Error","exports"],"sources":["../../../src/testkit/createChildEssentials.ts"],"sourcesContent":["import { TestContext } from '@wix/fe-essentials-standalone/testkit';\nimport { CreateEssentialsOptions } from '@wix/fe-essentials';\nimport { CreateErrorHandlerTestkitOptions } from './createErrorHandlerTestkit';\nimport { EventEmitter } from 'events';\n\nexport interface CreateChildEssentialsParams {\n  context: TestContext;\n  options: CreateErrorHandlerTestkitOptions;\n  essentialsTestkit: {\n    sentryTransport: any;\n  };\n  events: EventEmitter;\n}\n\nexport const createChildEssentials =\n  ({\n    essentialsTestkit,\n    context,\n    events,\n    options: { translations },\n  }: CreateChildEssentialsParams) =>\n  (options: CreateEssentialsOptions) => {\n    return context.createChildEssentials({\n      ...options,\n      ...(options.errorMonitor && {\n        errorMonitor: {\n          ...options.errorMonitor,\n          transport: essentialsTestkit.sentryTransport,\n        },\n      }),\n      ...(options.i18n && {\n        i18n: {\n          ...options.i18n,\n          asyncMessagesLoader: async (locale: string) => {\n            if (translations?.pause) {\n              await new Promise((resolve, reject) => {\n                events.once('translations-ready', resolve);\n                events.once('translations-error', (errorLng?: string) => {\n                  if (errorLng == null || errorLng === locale) {\n                    reject(new Error('Translations error'));\n                  }\n                });\n              });\n            }\n            return (await options.i18n?.asyncMessagesLoader?.(locale)) ?? {};\n          },\n        },\n      }),\n    });\n  };\n"],"mappings":";;;;AAcO,MAAMA,qBAAqB,GAChCA,CAAC;EACCC,iBAAiB;EACjBC,OAAO;EACPC,MAAM;EACNC,OAAO,EAAE;IAAEC;EAAa;AACG,CAAC,KAC7BD,OAAgC,IAAK;EACpC,OAAOF,OAAO,CAACF,qBAAqB,CAAC;IACnC,GAAGI,OAAO;IACV,IAAIA,OAAO,CAACE,YAAY,IAAI;MAC1BA,YAAY,EAAE;QACZ,GAAGF,OAAO,CAACE,YAAY;QACvBC,SAAS,EAAEN,iBAAiB,CAACO;MAC/B;IACF,CAAC,CAAC;IACF,IAAIJ,OAAO,CAACK,IAAI,IAAI;MAClBA,IAAI,EAAE;QACJ,GAAGL,OAAO,CAACK,IAAI;QACfC,mBAAmB,EAAE,MAAOC,MAAc,IAAK;UAAA,IAAAC,aAAA;UAC7C,IAAIP,YAAY,YAAZA,YAAY,CAAEQ,KAAK,EAAE;YACvB,MAAM,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;cACrCb,MAAM,CAACc,IAAI,CAAC,oBAAoB,EAAEF,OAAO,CAAC;cAC1CZ,MAAM,CAACc,IAAI,CAAC,oBAAoB,EAAGC,QAAiB,IAAK;gBACvD,IAAIA,QAAQ,IAAI,IAAI,IAAIA,QAAQ,KAAKP,MAAM,EAAE;kBAC3CK,MAAM,CAAC,IAAIG,KAAK,CAAC,oBAAoB,CAAC,CAAC;gBACzC;cACF,CAAC,CAAC;YACJ,CAAC,CAAC;UACJ;UACA,OAAO,CAAC,QAAAP,aAAA,GAAMR,OAAO,CAACK,IAAI,aAAZG,aAAA,CAAcF,mBAAmB,oBAAjCE,aAAA,CAAcF,mBAAmB,CAAGC,MAAM,CAAC,MAAK,CAAC,CAAC;QAClE;MACF;IACF,CAAC;EACH,CAAC,CAAC;AACJ,CAAC;AAACS,OAAA,CAAApB,qBAAA,GAAAA,qBAAA","ignoreList":[]}