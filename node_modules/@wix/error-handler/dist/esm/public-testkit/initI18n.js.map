{"version":3,"names":["i18n","ICU","initI18n","_ref","locale","asyncMessagesLoader","i18nInstance","createInstance","lng","fallbackLng","keySeparator","use","customBackend","_ref2","type","init","read","language","_namespace","callback","translation","err"],"sources":["../../../src/public-testkit/initI18n.ts"],"sourcesContent":["import i18n, { BackendModule } from 'i18next';\nimport ICU from 'i18next-icu';\nimport { Messages } from '@wix/error-handler-core/types';\n\ninterface i18nOptions {\n  asyncMessagesLoader?: (language: string) => Promise<Messages>;\n  disableAutoInit?: boolean;\n  locale?: string;\n}\n\nexport const initI18n = ({ locale, asyncMessagesLoader }: i18nOptions) => {\n  const i18nInstance = i18n\n    .createInstance({\n      lng: locale || 'en',\n      fallbackLng: 'en',\n      keySeparator: false,\n    })\n    .use(ICU);\n\n  if (asyncMessagesLoader) {\n    i18nInstance.use(customBackend({ asyncMessagesLoader }));\n  }\n\n  return i18nInstance;\n};\n\nfunction customBackend({\n  asyncMessagesLoader,\n}: {\n  asyncMessagesLoader: (language: string) => Promise<Messages>;\n}): BackendModule {\n  return {\n    type: 'backend',\n    init: () => {},\n    read: async (language, _namespace, callback) => {\n      try {\n        const translation = await asyncMessagesLoader(language);\n        return callback(null, translation);\n      } catch (err) {\n        return callback(err as Error, null);\n      }\n    },\n  };\n}\n"],"mappings":"AAAA,OAAOA,IAAI,MAAyB,SAAS;AAC7C,OAAOC,GAAG,MAAM,aAAa;AAS7B,OAAO,MAAMC,QAAQ,GAAGC,IAAA,IAAkD;EAAA,IAAjD;IAAEC,MAAM;IAAEC;EAAiC,CAAC,GAAAF,IAAA;EACnE,MAAMG,YAAY,GAAGN,IAAI,CACtBO,cAAc,CAAC;IACdC,GAAG,EAAEJ,MAAM,IAAI,IAAI;IACnBK,WAAW,EAAE,IAAI;IACjBC,YAAY,EAAE;EAChB,CAAC,CAAC,CACDC,GAAG,CAACV,GAAG,CAAC;EAEX,IAAII,mBAAmB,EAAE;IACvBC,YAAY,CAACK,GAAG,CAACC,aAAa,CAAC;MAAEP;IAAoB,CAAC,CAAC,CAAC;EAC1D;EAEA,OAAOC,YAAY;AACrB,CAAC;AAED,SAASM,aAAaA,CAAAC,KAAA,EAIJ;EAAA,IAJK;IACrBR;EAGF,CAAC,GAAAQ,KAAA;EACC,OAAO;IACLC,IAAI,EAAE,SAAS;IACfC,IAAI,EAAEA,CAAA,KAAM,CAAC,CAAC;IACdC,IAAI,EAAE,MAAAA,CAAOC,QAAQ,EAAEC,UAAU,EAAEC,QAAQ,KAAK;MAC9C,IAAI;QACF,MAAMC,WAAW,GAAG,MAAMf,mBAAmB,CAACY,QAAQ,CAAC;QACvD,OAAOE,QAAQ,CAAC,IAAI,EAAEC,WAAW,CAAC;MACpC,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZ,OAAOF,QAAQ,CAACE,GAAG,EAAW,IAAI,CAAC;MACrC;IACF;EACF,CAAC;AACH","ignoreList":[]}