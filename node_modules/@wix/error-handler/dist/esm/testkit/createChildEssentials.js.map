{"version":3,"names":["createChildEssentials","_ref","essentialsTestkit","context","events","options","translations","errorMonitor","transport","sentryTransport","i18n","asyncMessagesLoader","locale","_options$i18n","pause","Promise","resolve","reject","once","errorLng","Error"],"sources":["../../../src/testkit/createChildEssentials.ts"],"sourcesContent":["import { TestContext } from '@wix/fe-essentials-standalone/testkit';\nimport { CreateEssentialsOptions } from '@wix/fe-essentials';\nimport { CreateErrorHandlerTestkitOptions } from './createErrorHandlerTestkit';\nimport { EventEmitter } from 'events';\n\nexport interface CreateChildEssentialsParams {\n  context: TestContext;\n  options: CreateErrorHandlerTestkitOptions;\n  essentialsTestkit: {\n    sentryTransport: any;\n  };\n  events: EventEmitter;\n}\n\nexport const createChildEssentials =\n  ({\n    essentialsTestkit,\n    context,\n    events,\n    options: { translations },\n  }: CreateChildEssentialsParams) =>\n  (options: CreateEssentialsOptions) => {\n    return context.createChildEssentials({\n      ...options,\n      ...(options.errorMonitor && {\n        errorMonitor: {\n          ...options.errorMonitor,\n          transport: essentialsTestkit.sentryTransport,\n        },\n      }),\n      ...(options.i18n && {\n        i18n: {\n          ...options.i18n,\n          asyncMessagesLoader: async (locale: string) => {\n            if (translations?.pause) {\n              await new Promise((resolve, reject) => {\n                events.once('translations-ready', resolve);\n                events.once('translations-error', (errorLng?: string) => {\n                  if (errorLng == null || errorLng === locale) {\n                    reject(new Error('Translations error'));\n                  }\n                });\n              });\n            }\n            return (await options.i18n?.asyncMessagesLoader?.(locale)) ?? {};\n          },\n        },\n      }),\n    });\n  };\n"],"mappings":"AAcA,OAAO,MAAMA,qBAAqB,GAChCC,IAAA;EAAA,IAAC;IACCC,iBAAiB;IACjBC,OAAO;IACPC,MAAM;IACNC,OAAO,EAAE;MAAEC;IAAa;EACG,CAAC,GAAAL,IAAA;EAAA,OAC7BI,OAAgC,IAAK;IACpC,OAAOF,OAAO,CAACH,qBAAqB,CAAC;MACnC,GAAGK,OAAO;MACV,IAAIA,OAAO,CAACE,YAAY,IAAI;QAC1BA,YAAY,EAAE;UACZ,GAAGF,OAAO,CAACE,YAAY;UACvBC,SAAS,EAAEN,iBAAiB,CAACO;QAC/B;MACF,CAAC,CAAC;MACF,IAAIJ,OAAO,CAACK,IAAI,IAAI;QAClBA,IAAI,EAAE;UACJ,GAAGL,OAAO,CAACK,IAAI;UACfC,mBAAmB,EAAE,MAAOC,MAAc,IAAK;YAAA,IAAAC,aAAA;YAC7C,IAAIP,YAAY,YAAZA,YAAY,CAAEQ,KAAK,EAAE;cACvB,MAAM,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;gBACrCb,MAAM,CAACc,IAAI,CAAC,oBAAoB,EAAEF,OAAO,CAAC;gBAC1CZ,MAAM,CAACc,IAAI,CAAC,oBAAoB,EAAGC,QAAiB,IAAK;kBACvD,IAAIA,QAAQ,IAAI,IAAI,IAAIA,QAAQ,KAAKP,MAAM,EAAE;oBAC3CK,MAAM,CAAC,IAAIG,KAAK,CAAC,oBAAoB,CAAC,CAAC;kBACzC;gBACF,CAAC,CAAC;cACJ,CAAC,CAAC;YACJ;YACA,OAAO,CAAC,QAAAP,aAAA,GAAMR,OAAO,CAACK,IAAI,aAAZG,aAAA,CAAcF,mBAAmB,oBAAjCE,aAAA,CAAcF,mBAAmB,CAAGC,MAAM,CAAC,MAAK,CAAC,CAAC;UAClE;QACF;MACF,CAAC;IACH,CAAC,CAAC;EACJ,CAAC;AAAA","ignoreList":[]}