{"version":3,"names":["asyncMessagesLoader","TranslationsState","constructor","params","_defineProperty","key","i18n","t","getInitPromise","translate","createI18n","disableAutoInit","_initPromise","Promise","resolve","_this$i18n$on","_this$i18n2","failedLoading","onFailedLoading","lng","_ns","err","_this$i18n$off","_this$i18n","off","call","on","init","_ready","e","error"],"sources":["../../../src/state/TranslationsState.ts"],"sourcesContent":["import { Translate } from '../services/translations';\nimport { asyncMessagesLoader } from './asyncMessagesLoader';\nimport { CreateI18n } from '@wix/error-handler-core/types';\n\nexport interface TranslationsStateParams {\n  createI18n: CreateI18n;\n}\n\nexport class TranslationsState {\n  readonly i18n;\n\n  readonly _initPromise;\n\n  _ready?: boolean;\n\n  constructor(params: TranslationsStateParams) {\n    this.i18n = params.createI18n({\n      asyncMessagesLoader,\n      disableAutoInit: true,\n    });\n\n    this._initPromise = new Promise<Error | null>(async (resolve) => {\n      let failedLoading = false;\n\n      const onFailedLoading = (lng: string, _ns: string, err: Error) => {\n        // reject only when fallback lang (en) fails to load\n        if (lng !== 'en') {\n          return;\n        }\n        this.i18n.off?.('failedLoading', onFailedLoading);\n        failedLoading = true;\n        resolve(err);\n      };\n\n      this.i18n.on?.('failedLoading', onFailedLoading);\n\n      try {\n        await this.i18n.init();\n        if (failedLoading) {\n          return;\n        }\n        resolve(null);\n        this._ready = true;\n      } catch (e) {\n        resolve(e as Error);\n      }\n    });\n  }\n\n  async getInitPromise() {\n    const error = await this._initPromise;\n    if (error) {\n      throw error;\n    }\n  }\n\n  translate: Translate = (key, params) => this.i18n.t(key, params);\n\n  getTranslateFn = async (): Promise<Translate> => {\n    await this.getInitPromise();\n    return this.translate;\n  };\n}\n"],"mappings":";AACA,SAASA,mBAAmB,QAAQ,uBAAuB;AAO3D,OAAO,MAAMC,iBAAiB,CAAC;EAO7BC,WAAWA,CAACC,OAA+B,EAAE;IAAAC,eAAA;IAAAA,eAAA;IAAAA,eAAA;IAAAA,eAAA,oBAyCtB,CAACC,GAAG,EAAEF,MAAM,KAAK,IAAI,CAACG,IAAI,CAACC,CAAC,CAACF,GAAG,EAAEF,MAAM,CAAC;IAAAC,eAAA,yBAE/C,YAAgC;MAC/C,MAAM,IAAI,CAACI,cAAc,CAAC,CAAC;MAC3B,OAAO,IAAI,CAACC,SAAS;IACvB,CAAC;IA7CC,IAAI,CAACH,IAAI,GAAGH,OAAM,CAACO,UAAU,CAAC;MAC5BV,mBAAmB;MACnBW,eAAe,EAAE;IACnB,CAAC,CAAC;IAEF,IAAI,CAACC,YAAY,GAAG,IAAIC,OAAO,CAAe,MAAOC,OAAO,IAAK;MAAA,IAAAC,aAAA,EAAAC,WAAA;MAC/D,IAAIC,aAAa,GAAG,KAAK;MAEzB,MAAMC,eAAe,GAAGA,CAACC,GAAW,EAAEC,GAAW,EAAEC,GAAU,KAAK;QAAA,IAAAC,cAAA,EAAAC,UAAA;QAChE;QACA,IAAIJ,GAAG,KAAK,IAAI,EAAE;UAChB;QACF;QACA,CAAAG,cAAA,IAAAC,UAAA,OAAI,CAACjB,IAAI,EAACkB,GAAG,aAAbF,cAAA,CAAAG,IAAA,CAAAF,UAAA,EAAgB,eAAe,EAAEL,eAAe,CAAC;QACjDD,aAAa,GAAG,IAAI;QACpBH,OAAO,CAACO,GAAG,CAAC;MACd,CAAC;MAED,CAAAN,aAAA,IAAAC,WAAA,OAAI,CAACV,IAAI,EAACoB,EAAE,aAAZX,aAAA,CAAAU,IAAA,CAAAT,WAAA,EAAe,eAAe,EAAEE,eAAe,CAAC;MAEhD,IAAI;QACF,MAAM,IAAI,CAACZ,IAAI,CAACqB,IAAI,CAAC,CAAC;QACtB,IAAIV,aAAa,EAAE;UACjB;QACF;QACAH,OAAO,CAAC,IAAI,CAAC;QACb,IAAI,CAACc,MAAM,GAAG,IAAI;MACpB,CAAC,CAAC,OAAOC,CAAC,EAAE;QACVf,OAAO,CAACe,CAAU,CAAC;MACrB;IACF,CAAC,CAAC;EACJ;EAEA,MAAMrB,cAAcA,CAAA,EAAG;IACrB,MAAMsB,KAAK,GAAG,MAAM,IAAI,CAAClB,YAAY;IACrC,IAAIkB,KAAK,EAAE;MACT,MAAMA,KAAK;IACb;EACF;AAQF","ignoreList":[]}